# 🔄 리팩토링 V2: 사용자 선택 기반 힌트 시스템

## 📌 핵심 변경사항

### 1. 난이도 판정 방식 변경
**이전 (V1):** AI가 자동으로 난이도 판정 → 해당 난이도 힌트 생성  
**현재 (V2):** 사용자가 직접 난이도 선택 → 선택된 난이도에 맞는 힌트 내용 자동 구성

### 2. 주요 수정 모듈

#### `models/code_analyzer.py` (CodeDiagnosis)
- ✅ 난이도 자동 판정 로직 **제거**
- ✅ 4가지 지표만 계산: `similarity`, `syntax_errors`, `logic_errors`, `concept_level`
- ✅ 신규 메서드 추가:
  - `get_weak_areas_for_level(selected_level)`: 선택된 난이도에서 부족한 영역 식별
  - `is_suitable_for_level(selected_level)`: 난이도 적합성 판단 및 권장 메시지 반환

#### `models/adaptive_prompt.py` (AdaptivePromptGenerator)
- ✅ `generate_prompt()` 시그니처 변경: `selected_level` 매개변수 추가
- ✅ 부족한 영역 기반 힌트 구성 로직 추가
- ✅ 프롬프트에 적합성 메시지 포함

#### `hint-system/app.py` (VLLMHintApp)
- ✅ `generate_hint()` 시그니처 변경: `selected_level` 매개변수 추가
- ✅ Gradio UI: 3개 버튼 (초급/중급/고급) 추가
- ✅ 이벤트 핸들러: 각 버튼에 lambda로 난이도 주입
- ✅ 출력 포맷팅: 선택된 난이도 및 적합성 메시지 표시

---

## 🎯 작동 방식

### 사용자 플로우:
1. **문제 선택** → 문제를 불러오기
2. **코드 작성** → Python 코드 에디터에서 작성
3. **난이도 선택** → 🔰 초급 / 📚 중급 / 🎓 고급 버튼 클릭
4. **힌트 생성** → AI가 4가지 지표 분석 후 부족한 영역에 맞는 힌트 제공
5. **반복 학습** → Chain-of-Hints로 누적 학습 (COT)

### AI 분석 프로세스:
```
단계 1: 4가지 지표 진단
 ├─ 코드 유사도 (0-100%)
 ├─ 문법 오류 개수
 ├─ 논리 오류 개수
 └─ 개념 이해도 (1-5점)

단계 2: 사용자 선택 난이도 확인
 ├─ 초급: < 40% 유사도 or ≥ 6개 문법 오류
 ├─ 중급: 40-75% 유사도 or 2-5개 문법 오류
 └─ 고급: ≥ 76% 유사도 or ≤ 1개 문법 오류

단계 3: 부족한 영역 식별
 └─ 선택된 난이도 기준에 부족한 영역 자동 추출

단계 4: 힌트 내용 자동 구성
 └─ 부족한 영역에 집중된 힌트 생성

단계 5: Chain-of-Hints (COT)
 └─ 이전 힌트와 다른 각도로 점진적 정보 증가
```

---

## 📊 난이도별 기준

### 🔰 초급 (Novice)
- **조건**: 코드 유사도 < 40% **또는** 문법 오류 ≥ 6개 **또는** 논리 오류 ≥ 3개
- **힌트 특징**:
  - 함수명, 메서드명 직접 제시
  - 코드 예시 포함
  - 구체적이고 단계별 안내

### 📚 중급 (Intermediate)
- **조건**: 코드 유사도 40-75% **또는** 문법 오류 2-5개 **또는** 논리 오류 1-2개
- **힌트 특징**:
  - 추상적 개념 설명
  - 함수명 제공 금지
  - 코드 예시 금지
  - 논리 구조 힌트

### 🎓 고급 (Advanced)
- **조건**: 코드 유사도 ≥ 76% **또는** 문법 오류 ≤ 1개 + 논리 오류 = 0
- **힌트 특징**:
  - 소크라테스식 열린 질문
  - 스스로 발견하도록 유도
  - 함수명/코드 예시 금지
  - 사고 확장 질문

---

## 🚀 다음 단계 (TODO)

### 1. 힌트 사용 횟수 제한 시스템
환경 변수로 제어:
```python
# .env
HINT_LIMIT_ENABLED=true  # true: 제한 O, false: 제한 X
MAX_HINT_COUNT=10        # 총 사용 횟수
```

구현 계획:
- [ ] `config.py`에 환경 변수 추가
- [ ] `VLLMHintApp`에 사용 횟수 카운터 추가
- [ ] Gradio UI에 남은 횟수 표시
- [ ] 제한 초과 시 버튼 비활성화

### 2. 통합 테스트 업데이트
- [ ] `test_adaptive_system.py` 수정 (난이도 선택 매개변수 추가)
- [ ] 3가지 난이도별 테스트 케이스 작성
- [ ] UI 버튼 클릭 시나리오 테스트

### 3. 문서화
- [ ] README.md 업데이트 (사용자 선택 방식 설명)
- [ ] 사용 가이드 스크린샷 추가
- [ ] API 문서 작성 (개발자용)

---

## ✅ 완료 항목

- [x] `CodeDiagnosis` 난이도 자동 판정 제거
- [x] `get_weak_areas_for_level()` 메서드 추가
- [x] `is_suitable_for_level()` 메서드 추가
- [x] `AdaptivePromptGenerator.generate_prompt()` 시그니처 변경
- [x] `VLLMHintApp.generate_hint()` 시그니처 변경
- [x] Gradio UI 3개 버튼 추가 (초급/중급/고급)
- [x] 이벤트 핸들러 lambda 함수 적용
- [x] 출력 포맷팅 수정 (선택 난이도, 적합성 메시지)
- [x] 문법 검증 통과 (모든 모듈)

---

## 📝 사용 예시

### UI 사용법:
1. 문제 선택: "백준 1000번" 선택 → 불러오기
2. 코드 작성:
```python
# 작성 중인 코드
n = int(input())
# TODO: 합 계산
```
3. 버튼 클릭: "📚 중급 힌트" 클릭
4. AI 응답:
```
📚 중급 힌트 (사용자 선택)

반복문의 필요성을 느끼셨나요? 
1부터 N까지의 숫자를 하나씩 처리하려면 어떤 구조가 필요할까요?

💬 난이도 적합성
중급 힌트가 적절합니다.

💪 격려 메시지
점점 나아지고 있습니다! 조금만 더 노력하면 완성할 수 있어요.
```

---

## 🔧 기술 스택
- **백엔드**: Python 3.10+
- **LLM 추론**: vLLM 0.6.3+ (Docker)
- **웹 UI**: Gradio 4.44+
- **코드 분석**: AST, difflib
- **환경 관리**: python-dotenv

---

## 📞 문의
- 이슈 발생 시: GitHub Issues
- 개선 제안: Pull Request 환영
